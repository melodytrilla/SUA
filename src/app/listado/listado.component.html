<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<div style="overflow-y:hidden;" class="texto-regular">
    <app-global-nav-bar></app-global-nav-bar>
    <app-navbar></app-navbar>
    <div class="topBar fila">
        <div class="ordenar fila">

            <mat-checkbox 
                color="primary"
                [(value)]="allSelected"
                (change)="checkAll()"
                matTooltip="Seleccionar todas">
            </mat-checkbox>

            <button mat-raised-button  [class.is-hidden]="scrollListener == 0" color="primary" class="light fixed" (click)= "topBottomClick()"><mat-icon>keyboard_arrow_up</mat-icon> </button>
            
            <mat-form-field class="selector">
                <mat-label class="texto-regular">Ordenar por</mat-label>
                <mat-select>
                    <mat-option id="boton" class="texto-regular" value="fechaCreacion" (click)="ordenar('fechaR')"> Fecha de creaci√≥n </mat-option>
                    <mat-option id="boton" class="texto-regular" value="fechaEstado" (click)="ordenar('fechaE')"> Fecha de estado </mat-option>
                    <mat-option id="boton" class="texto-regular" value="cantidadReiteraciones" (click)="ordenar('reiteraciones')"> Cantidad de reiteraciones </mat-option>
                    <mat-option id="boton" class="texto-regular" value="cantidadSolicitantes" (click)="ordenar('solic')"> Cantidad de solicitantes </mat-option>
                    <mat-option id="boton" class="texto-regular" value="cantidadAsignaciones" (click)="ordenar('asig')"> Cantidad de asignaciones </mat-option>
                    <mat-option id="boton" class="texto-regular" value="cantidadIntervenciones" (click)="ordenar('inter')"> Cantidad de intervenciones </mat-option>
                </mat-select>
            </mat-form-field>
            <button mat-button (click)="togglePlay()">
                <mat-icon *ngIf="!asc">arrow_downward</mat-icon>
                <mat-icon *ngIf="asc">arrow_upward</mat-icon>
            </button>
        </div>
        <div *ngIf="items" class="total fila texto-semibold">
            <div *ngIf="items.length!='1'">{{items.length}} solicitudes</div>
            <div *ngIf="items.length=='1'">{{items.length}} solicitud</div>
            <div>
                <mat-menu #appMenu="matMenu">
                    <button mat-menu-item (click)="downloadFile()">Exportar a CSV</button>
                    <button mat-menu-item (click)="exportAsXLSX()">Exportar a XLSX</button>
                  </mat-menu>
                  
                  <button mat-icon-button [matMenuTriggerFor]="appMenu">
                    <mat-icon>more_vert</mat-icon>
                  </button>
            </div>
        </div>
    </div>
    <mat-divider></mat-divider>

    <div style="display: flex; justify-content: center; ">
        <div *ngIf="loading">
            <mat-progress-spinner
                color="primary" 
                mode="indeterminate">
            </mat-progress-spinner> 
        </div>

        <div *ngIf="!loading && !items">
            <h4 class="texto-regular">Ningun resultado.</h4>
        </div>
    </div>
    <div id="here">
    <cdk-virtual-scroll-viewport *ngIf="!loading && items" style="height: 73vh" itemSize="93" (scrolledIndexChange)="nextBatch($event)">
        <div  mat-list *cdkVirtualFor="let item of items | sort:{ property: criterio, descending: !asc}" class="lista">
            <div mat-list-item class="content fila">
                <div class="fila" style="width: 100%;">
                    <div class="fila">
                        <div>
                            <div *ngIf="item.estado=='Pendiente'" class="accent accentP"></div>
                            <div *ngIf="item.estado=='En curso'" class="accent accentEC"></div>
                            <div *ngIf="item.estado=='Resuelto'" class="accent accentR"></div>
                            <div *ngIf="item.estado=='cerrado'" class="accent accentC"></div>
                        </div>

                        <div style="width: 1%">
                            <mat-checkbox 
                                color="primary" 
                                [checked]="item.checked"
                                (change)="toggleItem(item)">
                            </mat-checkbox>
                        </div>
                    </div>
                    <div class="click fila hov" (click)="this.sendto(item.id, item.anio)">
                        <div class="colum0 columna">
                            <div class="texto-semibold">{{item.id}}-{{item.anio}}</div>
                            <div><img src="{{item.imagen}}"></div>
                        </div>
                    
                        <div class="tablagen">
                            <div class="col colum1">
                                <div class="fil">
                                    {{item.fecha_hora_registro}}
                                </div>
                                <div class="fil">
                                    <div *ngIf="item.categoria=='Alumbrado'">
                                        <mat-icon class="fsua fsua-alumbrado_publico"></mat-icon> {{item.subtipo}}
                                    </div>
                                    <div *ngIf="item.categoria=='Colectivos urbanos'">
                                        <mat-icon class="fsua fsua-colectivos_urbanos"></mat-icon> {{item.subtipo}}
                                    </div>
                                </div>
                                <div class="fil">
                                    <div *ngIf="item.altura>0">{{item.calle}} {{item.altura}}</div>
                                    <div *ngIf="item.interseccion != ''">{{item.calle}} Y {{item.interseccion}}</div>
                                </div>
                            </div>
                            <div class="col colum2">
                                <div class="fil texto-regularitalic font15">
                                    <mat-icon class="fsua fsua-recientes"></mat-icon>{{item.tiempo}}
                                </div>
                                <div class="fil">
                                    <div *ngIf="item.opinion=='positivo'">
                                        <mat-icon class="fsua fsua-bueno"></mat-icon> {{item.estado}}
                                    </div>
                                    <div *ngIf="item.opinion=='negativo'">
                                        <mat-icon class="fsua fsua-malo"></mat-icon> {{item.estado}}
                                    </div>
                                    <div *ngIf="item.opinion=='neutro'">
                                        <mat-icon class="fsua fsua-neutro"></mat-icon> {{item.estado}}
                                    </div>
                                    <div *ngIf="item.opinion==''">{{item.estado}}</div>
                                </div>
                                <div class="fil">
                                    <div *ngIf="item.estado== 'Resuelto'"> {{item.detalle_intervencion}}</div>
                                    <div *ngIf="item.estado== 'En curso'">{{item.descripcion}}</div>
                                    <div *ngIf="item.estado== 'Pendiente'"></div>
                                </div>
                            </div>
                            <div class="col colum3">
                                <div class="fil texto-regularitalic">
                                    <div *ngIf="item.intervenciones.length>0" class="tiempo fila font15">
                                        <div>
                                            <mat-icon matBadge="{{item.intervenciones.length}}" matBadgeSize="small"
                                                class="fsua fsua-intervenido"></mat-icon>
                                        </div>
                                        <div *ngIf="item.fecha_hora_intervencion!=''">{{item.tiempoInterv}}</div>
                                    </div>
                                </div>
                                <div class="fil">
                                    <mat-icon></mat-icon>
                                </div>
                                <div class="fil texto-regularitalic">
                                    <div *ngIf="item.asignaciones.length>0" class="tiempo fila font15">
                                        <div>
                                            <mat-icon matBadge="{{item.asignaciones.length}}" matBadgeSize="small"
                                                class="fsua fsua-mapa"></mat-icon>
                                        </div>
                                        <div *ngIf="item.fecha_hora_asignacion!=''">{{item.tiempoMap}}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col colum">
                                <div class="fil">
                                    <div *ngIf="item.cantTel>0">
                                        <mat-icon matBadge="{{item.cantTel}}" matBadgeSize="small" class="fsua fsua-tel">
                                        </mat-icon>
                                    </div>
                                </div>
                                <div class="fil">
                                    <mat-icon></mat-icon>
                                </div>
                                <div class="fil">
                                    <div *ngIf="item.solicitantes.length>0">
                                        <mat-icon matBadge="{{item.solicitantes.length}}" matBadgeSize="small"
                                            class="fsua fsua-mi_perfil-o"></mat-icon>
                                    </div>
                                </div>
                            </div>
                            <div class="col colum">
                                <div class="fil">
                                    <div *ngIf="(item.solicitantes.length - 1 )>0">
                                        <mat-icon matBadge="{{item.solicitantes.length -1}}" matBadgeSize="small"
                                            class="fsua fsua-logo"></mat-icon>
                                    </div>
                                </div>
                                <div class="fil">
                                    <mat-icon></mat-icon>
                                </div>
                                <div>
                                    <div class="fil">
                                        <div *ngIf="item.reiteraciones>0">
                                            <mat-icon matBadge="{{item.reiteraciones}}" matBadgeSize="small"
                                                class="fsua fsua-warning"></mat-icon>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class=" col hov">
                                <div class="fil">
                                    <mat-icon></mat-icon>
                                </div>
                                <div class="fil">
                                    <mat-icon>keyboard_arrow_right</mat-icon>
                                </div>
                                <div class="fil">
                                    <mat-icon></mat-icon>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <mat-divider></mat-divider>
        </div>
    </cdk-virtual-scroll-viewport>
</div>
</div>